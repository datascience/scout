{{> header}}
<form class="container" method="POST">
	<legend>Create source adaptor</legend>

	<label>Name</label> <input name="instance" type="text"
		placeholder="Unique identifying name"> <label>Plug-in</label>
	<select name="plugin" id="plugin-select"> {{#plugin}}
		<option value="{{name}}|{{version}}">{{name}} version
			{{version}}</option>{{/plugin}}
	</select> <label>Configuration</label>
	<div class="well" id="configuration"></div>

	<label>Source</label> <select name="source"> {{#source}}
		<option value="{{name}}">{{name}}: {{description}}</option>{{/source}}
	</select> <a class="btn btn-link" href="{{mustacheletPath}}/source/new">create new
		source</a> <br /> <br />
	<button type="submit" class="btn btn-primary">Create</button>

</form>
{{> jslibs}} {{=<% %>=}}
<script id="plugin_configuration" type="text/html">
{{#parameters}}
<label>{{description}}{{#required}} (required){{/required}}{{#hidden}} (hidden){{/hidden}}</label>
<input type="text" value="{{value}}" name="config.{{key}}">
{{/parameters}}

</script>
<%={{ }}=%>

<script>
function updateConfiguration() {
	var pluginSelect = document.getElementById("plugin-select");
	var pluginId = pluginSelect.options[pluginSelect.selectedIndex].value;
	var pluginIdSplit = pluginId.split("|", 2);
	var pluginName = pluginIdSplit[0];
	var pluginVersion = pluginIdSplit[1];
	
	$.getJSON('{{contextPath}}/api/plugin.json/'+pluginName+'/'+pluginVersion, function(plugin_data) {
		var plugin = ich.plugin_configuration(plugin_data);
		$('#configuration').html(plugin);
	});
}


$(document).ready(function() {
	var pluginSelect = document.getElementById("plugin-select");
	pluginSelect.onchange = updateConfiguration;
	updateConfiguration();
	});
</script>
{{> footer}}


