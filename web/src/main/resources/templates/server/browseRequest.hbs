{{#partial "title"}}Scout - Browse - Request{{/partial}} {{#partial
"NavBrowseClass"}}active{{/partial}} {{#partial "content"}}
<div class="container">
	{{#request}}
	<div class="page-header">
		<h1>
			Request<br /> <small>{{description}}</small>
		</h1>
	</div>

	{{#triggers}}
	<h2>
		Trigger <small>{{id}}</small>
	</h2>
	<p>Task initiated by schedule or events that will execute the
		assessment of a question or a plan in order to notify users of events.</p>

	<h3>Initiators</h3>
	<p>
		<strong>Scheduling period: </strong> {{period}}
	</p>
	<div>
		<strong>Watched categories</strong> {{#if types}}
		<table class="table table-striped">
			<thead>
				<tr>
					<th>Name</th>
					<th>Description</th>
					<th style="width: 10%">Action</th>
				</tr>
			</thead>
			<tbody>
				{{#each types}}
				<tr>
					<td>{{name}}</td>
					<td>{{description}}</td>
					<td><a class="btn btn-small btn-link"
						href="{{../mustacheletPath}}/browse/type/{{id}}"><i
							class=" icon-th-list"></i></a></td>
				</tr>
				{{/each}}
			</tbody>
		</table>
		{{/if}} {{#unless types}}
		<p>None</p>
		{{/unless}}
	</div>
	<div>
		<strong>Watched entities</strong> {{#if entities}} TODO {{/if}}
		{{#unless entities}}
		<p>None</p>
		{{/unless}}
	</div>
	<div>
		<strong>Watched properties</strong> {{#if properties}} TODO {{/if}}
		{{#unless properties}}
		<p>None</p>
		{{/unless}}
	</div>

	{{#if question}}
	<h3>Question</h3>
	{{#with question}}
	<p>
		<strong>Target: </strong> {{target}}
	</p>
	<div>
		<span> <strong>SPARQL</strong>
		</span>
		<pre style="margin: 0;">SELECT ?s WHERE { <span
				id="sparql-class-declaration"></span> {{#if sparql}}.
					{{sparql}}{{/if}}}</pre>
	</div>

	{{/with}} {{/if}} {{#if plan}}
	<h3>Preservation Plan</h3>
	{{#with plan}}
	<p>
		<strong>Plan id:</strong> {{planId}}
	</p>
	{{/with}} {{/if}}

	<h3>Notifications</h3>
	<p>List of notification actions that will be executed when the
		question or plan assessement finds a significant event.</p>

	{{#if notifications}}
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Type</th>
				<th>Parameters</th>
			</tr>
		</thead>
		<tbody>
			{{#each notifications}}
			<tr>
				<td>{{type}}</td>
				<td>{{#each parameters}}
					<ul class="unstyled">
						<li><strong>{{key}}:</strong> {{value}}</li>
					</ul> {{/each}}
				</td>
			</tr>
			{{/each}}
		</tbody>
	</table>

	{{/if}} {{#unless notifications}}
	<div class="alert alert-warning">
		<b>Empty!</b> There are no defined notifications for this trigger.
	</div>
	{{/unless}} {{/triggers}} {{^triggers}}
	<div class="alert alert-warning">
		<b>Empty!</b> There are no defined triggers for this request.
	</div>
	{{/triggers}} <a class="btn btn-large btn-warning" type="button"><i
		class="icon-edit icon-white"></i> Edit</a>
	<button data-toggle="modal" data-target="#deleteConfirmModal"
		class="btn btn-large btn-danger">
		<i class="icon-remove-circle icon-white"></i> Delete
	</button>
	<!-- Delete confirmation modal -->
	<div id="deleteConfirmModal" class="modal hide fade" tabindex="-1"
		role="dialog" aria-labelledby="deleteConfirmModalLabel"
		aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"
				aria-hidden="true">Ã—</button>
			<h3 id="deleteConfirmModalLabel">Delete confirmation</h3>
		</div>
		<div class="modal-body">
			<p>Are you sure you want to delete the request? This action is
				irreversible!</p>
		</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<button id="deleteButton" class="btn btn-primary btn-danger">Sure,
				delete it</button>
		</div>
	</div>
	{{/request}} {{^request}}
	<div class="alert alert-error">
		<b>Not found!</b> Could not find request {{id}}.
	</div>

	{{/request}}
</div>

{{/partial}} {{#partial "scripts"}}
<script type="text/javascript">
	$(document).ready(function() {
		$('.btn').button();
		var deleteButton = document.getElementById('deleteButton');
		deleteButton.onclick = function() {
			var btn = $(this);
			btn.button('loading');
			$.ajax({
				url : '{{contextPath}}/api/asyncrequest.json/{{request.id}}',
				type : 'DELETE',
				success : function() {
					 window.location = '{{mustacheletPath}}/dashboard';
				},
				error : function(xhr, ajaxOptions, thrownError) {
					alert(xhr.responseText);
					btn.button('reset');
					$('#deleteConfirmModal').hide();
				}
			});
		};
	});
</script>
{{/partial}} {{>base}}
